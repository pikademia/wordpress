jQuery(document).ready(function(s){if(s("#requireConfirmation").length>0){let e=20,r=e,i=500;const t=["email","name"],c=(s,e,r)=>s.filter(s=>-1!==r.map(r=>-1!==s[r].toLowerCase().indexOf(e.toLowerCase())).indexOf(!0));new Vue({directives:{infiniteScroll:infiniteScroll},el:"#acym__list__settings__subscribers",data:{subscribed:[],displayedSubscribers:[],busy:!1,listid:0,total:0,loading:!0,searchSubscribers:"",requireConfirmation:0,users_ordering:"id",users_ordering_sort_order:"desc"},mounted:function(){document.querySelector('.acym__list__settings__subscribers__search input[type="text"]').addEventListener("keydown",function(s){if("Enter"===s.key)return s.preventDefault(),!1}),this.requireConfirmation=document.getElementById("requireConfirmation").value;let s=document.getElementById("acym__list__settings__subscribers__listing");null!==s&&(s.style.display="flex"),this.subscribed=acym_helper.parseJson(document.getElementById("subscribers_subscribed").value),this.listid=document.querySelector('[name="id"]').value,this.total=this.subscribed.length,this.displayedSubscribers=this.subscribed.slice(0,r),this.total<i?this.loading=!1:this.getAllSubscribers()},methods:{loadMoreSubscriber(){r+=e,this.displayedSubscribers=""===this.searchSubscribers?this.subscribed.slice(0,r):c(this.subscribed,this.searchSubscribers,t)},getAllSubscribers(){let r=document.querySelector('[name="ctrl"]').value;s.get(ACYM_AJAX_URL+"&ctrl="+r+"&task=loadMoreSubscribers&offset="+this.total+"&perCalls="+i+"&listid="+this.listid+"&orderBy="+this.users_ordering+"&orderByOrdering="+this.users_ordering_sort_order,s=>{if(0===(s=acym_helper.parseJson(s)).data.subscribers.length)return this.loading=!1,!0;let r=s.data.subscribers.length;return this.subscribed=this.subscribed.concat(s.data.subscribers),this.total+=r,this.displayedSubscribers=this.subscribed.slice(0,e),r<i?(this.loading=!1,!0):(this.getAllSubscribers(),!0)})},doSearch(){""===this.searchSubscribers?(r=e,this.displayedSubscribers=this.subscribed.slice(0,r)):this.displayedSubscribers=c(this.subscribed,this.searchSubscribers,t)},unsubscribeUser(e){let r=s("#acym_form");s('[name="acym__entity_select__selected"]').val(""),s('[name="acym__entity_select__unselected"]').val("["+e+"]"),r.find('[name="task"]').attr("value","saveSubscribers"),r.submit()},sortOrdering(e){let r=s('[name="users_ordering_sort_order"]');r.val("asc"==r.val()?"desc":"asc"),s(e.target).toggleClass("acymicon-sort-amount-desc acymicon-sort-amount-asc"),this.users_ordering_sort_order=r.val(),this.getAgainSubscribers()},getAgainSubscribers(){this.subscribed=[],this.displayedSubscribers=[],this.total=0,this.loading=!0,this.getAllSubscribers()}},watch:{searchSubscribers(){this.doSearch()},users_ordering(){this.getAgainSubscribers()}}})}});